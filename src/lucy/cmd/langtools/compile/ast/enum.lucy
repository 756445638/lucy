import "lucy/cmd/langtools/compile/jvm/cg"

public class EnumName {
	public Enum    Enum
	public name    string
	public pos     Pos
	public value   int // int is bigger enough
	public comment string
	public NoNeed  Expression
}


public class Enum   {
	public isGlobal        bool
	public isBuildIn       bool
	public accessFlags     char
	public name            string
	public pos             Pos
	public Enums           []EnumName
	public Init            Expression //should be a int expression
	public used            bool
	public DefaultValue    int
	public loadFromOutSide bool
	public FirstValueIndex int
	public comment         string
	
	fn isPublic() -> (is bool) {
		return this.accessFlags&cg.AccClassPublic != 0
	}

	
	fn check() -> (errs []error = []error{}) {
		var initV int = 0
		if this.Init != null {
			if is, err := this.Init.constantFold(); err != null {
				errs.append(err)
			} else {
				if is == false {
					err := new error(sprintf("%s enum type must inited by 'int' literal",
						this.pos.errMsgPrefix()))
					errs.append(err)
				} else {
					initV = int(this.Init.getLongValue())
				}
			}
		}
		this.DefaultValue = initV
		for k, v := range this.Enums {
			if v.NoNeed != null {
				errs.append(new error(sprintf("%s enum only expect 1 init value",
					v.pos.errMsgPrefix())))
			}
			if k < this.FirstValueIndex {
				v.value = initV - int(this.FirstValueIndex-k)
			} else {
				v.value = initV + int(k-this.FirstValueIndex)
			}
		}
		return errs
	}	
}


